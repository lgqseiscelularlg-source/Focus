<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RealityTour AR</title>
    <link rel="stylesheet" href="style.css" />

    <!-- Librerías de A-Frame y AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawcdn.githack.com/jeromeetienne/AR.js/1.7.5/aframe/build/aframe-ar.js"></script>
  </head>

  <body>
    <div id="desktop-warning" class="hidden">
      <p>Para una mejor experiencia, abre esta página desde un dispositivo móvil.</p>
      <button onclick="document.getElementById('desktop-warning').style.display='none'">
        Continuar igualmente
      </button>
    </div>

    <!-- Texto flotante para la distancia -->
    <div id="distancia-display">Distancia: -- m</div>

    <!-- Texto flotante para la version que se compila -->
    <div id="version-label">Versión 3</div>


    <!-- Escena AR principal -->
    <a-scene
      embedded
      vr-mode-ui="false"
      arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;"
    >
      <!-- Cubo 3D geolocalizado -->
      <a-box
        id="geoBox"
        gps-entity-place="latitude: -29.477051; longitude: -66.889616"
        color="red"
        scale="2 2 2"
        visible="false"
      ></a-box> 
      
    <!-- Modelo 3D GLB geolocalizado -->
    <a-entity
      id="objeto3d"
      gltf-model="./models/goku.glb"
      gps-entity-place="latitude: -29.477051; longitude: -66.889616"
      position="0 2 0"
      scale="200 200 200"
      visible="false"
      gesture-handler
    ></a-entity>

      <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

        <!-- Modulo para gestos sobre el objeto -->
        <script>
    AFRAME.registerComponent("gesture-handler", {
      schema: {
        enabled: { default: true },
      },
      init: function () {
        this.handleScale = 1;
        this.handleRotation = 0;
        this.startRotation = 0;
        this.startDistance = 0;
    
        const el = this.el;
        const sceneEl = el.sceneEl;
    
        // Un solo dedo → rotar
        sceneEl.canvas.addEventListener("touchstart", (e) => {
          if (e.touches.length === 1) {
            this.startX = e.touches[0].pageX;
            this.startRotation = this.handleRotation;
          } else if (e.touches.length === 2) {
            this.startDistance = this.getDistance(e.touches);
            this.startScale = this.handleScale;
          }
        });
    
        sceneEl.canvas.addEventListener("touchmove", (e) => {
          if (!this.data.enabled) return;
    
          // Rotación
          if (e.touches.length === 1) {
            const deltaX = e.touches[0].pageX - this.startX;
            this.handleRotation = this.startRotation + deltaX * 0.5;
            el.object3D.rotation.y = THREE.MathUtils.degToRad(this.handleRotation);
          }
    
          // Zoom (pinch)
          if (e.touches.length === 2) {
            const newDistance = this.getDistance(e.touches);
            const scaleChange = newDistance / this.startDistance;
            this.handleScale = this.startScale * scaleChange;
            el.object3D.scale.set(
              this.handleScale,
              this.handleScale,
              this.handleScale
            );
          }
        });
      },
      getDistance(touches) {
        const dx = touches[0].pageX - touches[1].pageX;
        const dy = touches[0].pageY - touches[1].pageY;
        return Math.sqrt(dx * dx + dy * dy);
      },
    });
    </script>

    
    <script src="script.js"></script>
  </body>
</html>






